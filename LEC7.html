<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار شامل: المحاضرة السابعة - تطبيق المبادئ</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.rtlcss.com/bootstrap/v4.5.3/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap');

        body {
            direction: rtl;
            font-size: 16px;
            font-family: 'Cairo', sans-serif;
            background-color: #f4f6f9;
            overflow-x: hidden;
        }

        :root {
            --color: #F28A24;
            --dark: #212529;
            --green: #28a745;
            --red: #dc3545;
        }

        h1, h2, h3, h4, h5, p, a, span, div, label {
            font-family: 'Cairo', sans-serif;
            text-align: right;
        }

        /* تنسيق الهيدر واللوجوهات */
        .navbar {
            background-color: var(--dark);
            border-bottom: 5px solid var(--color);
            padding: 10px 0;
            z-index: 100;
            position: relative;
        }

        .header-logos {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            background: #fff;
            padding: 5px 15px;
            border-radius: 50px;
            margin-left: 15px;
        }

        .header-logos img {
            height: 50px;
            width: auto;
            transition: transform 0.3s;
        }

        .header-logos img:hover {
            transform: scale(1.1);
        }

        .navbar-brand {
            font-size: 1.2rem;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .header-logos { display: none; }
            .header-logos-mobile {
                display: flex;
                justify-content: center;
                margin-bottom: 10px;
            }
            .header-logos-mobile img {
                height: 40px;
                margin: 0 5px;
            }
        }

        /* الأزرار */
        .btn-warning {
            background-color: var(--color);
            border-color: var(--color);
            color: #FFF;
            padding: 12px 40px;
            font-weight: bold;
            font-size: 1.1rem;
            border-radius: 50px;
            transition: all 0.3s ease;
        }

        .btn-warning:hover {
            background-color: #d6761b;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(242, 138, 36, 0.4);
        }

        /* كارت الاختبار */
        .quiz-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
            margin-top: 50px;
            margin-bottom: 50px;
            border-top: 6px solid var(--color);
            backdrop-filter: blur(10px);
        }

        /* صناديق الأسئلة */
        .question-box {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #eee;
            border-right: 5px solid #ddd;
            transition: all 0.3s;
            position: relative;
        }

        .question-box:hover {
            border-right-color: var(--color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transform: translateX(-5px);
        }

        .question-title {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 18px;
            line-height: 1.6;
        }

        /* خيارات الإجابة */
        .options label {
            display: block;
            padding: 12px 20px;
            background: #f8f9fa;
            border: 2px solid transparent;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-weight: 600;
            color: #555;
        }

        .options input[type="radio"] {
            margin-left: 10px;
            transform: scale(1.2);
        }

        .options label:hover {
            background: #fffcf5;
            border-color: var(--color);
            color: var(--color);
        }

        .options input[type="radio"]:checked + span {
            color: var(--color);
        }

        /* التغذية الراجعة داخل السؤال (أثناء الحل) */
        .feedback {
            margin-top: 15px;
            font-size: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.5s;
        }

        .question-box.correct-box {
            border-right-color: var(--green);
            background-color: #f0fff4;
        }

        .question-box.wrong-box {
            border-right-color: var(--red);
            background-color: #fff5f5;
        }

        /* أقسام الاختبار */
        .section-header {
            background: var(--dark);
            color: #fff;
            padding: 15px 25px;
            border-radius: 10px;
            margin: 50px 0 30px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .section-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* صندوق النتيجة */
        .result-box {
            display: none;
            text-align: center;
            padding: 40px;
            background: var(--dark);
            color: #fff;
            border-radius: 20px;
            margin-top: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
        }

        .result-score {
            font-size: 4rem;
            color: var(--color);
            font-weight: 800;
            margin: 20px 0;
        }

        /* =========================================
           تنسيق قسم "سجل الأخطاء" الجديد
           ========================================= */
        #mistakesReport {
            display: none;
            margin-top: 30px;
            text-align: right;
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            color: #333;
        }

        .mistake-card {
            border: 1px solid #eee;
            border-right: 5px solid var(--red);
            padding: 15px;
            margin-bottom: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
        }

        .mistake-question {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .answer-comparison {
            display: flex;
            flex-direction: column;
            gap: 5px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }

        .user-answer {
            color: var(--red);
            font-weight: 600;
        }

        .correct-answer-text {
            color: var(--green);
            font-weight: 600;
        }

        /* الخلفية المتحركة */
        .background-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .shape {
            position: absolute;
            opacity: 0.15;
            animation: float 20s infinite linear;
        }

        .shape.square { width: 80px; height: 80px; border: 4px solid var(--color); }
        .shape.circle { width: 120px; height: 120px; border: 4px solid var(--dark); border-radius: 50%; }
        .shape.triangle { 
            width: 0; height: 0; 
            border-left: 40px solid transparent; 
            border-right: 40px solid transparent; 
            border-bottom: 80px solid var(--color); 
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }

    </style>
</head>
<body>

    <!-- الخلفية الهندسية -->
    <div class="background-shapes">
        <div class="shape square" style="left: 10%; bottom: -10%; animation-duration: 15s;"></div>
        <div class="shape circle" style="left: 20%; bottom: -20%; animation-duration: 25s; animation-delay: 2s;"></div>
        <div class="shape triangle" style="left: 35%; bottom: -15%; animation-duration: 18s;"></div>
        <div class="shape square" style="left: 50%; bottom: -30%; border-color: var(--dark); animation-duration: 30s;"></div>
        <div class="shape circle" style="left: 70%; bottom: -10%; border-color: var(--color); animation-duration: 22s;"></div>
        <div class="shape triangle" style="left: 85%; bottom: -25%; border-bottom-color: var(--dark); animation-duration: 20s;"></div>
        <div class="shape square" style="left: 90%; bottom: -5%; animation-duration: 12s;"></div>
    </div>

    <!-- الهيدر -->
    <nav class="navbar navbar-expand-lg">
        <div class="container d-flex justify-content-between align-items-center">
            
            <div class="d-flex align-items-center">
                <!-- أيقونة ورقة الشجر -->
                <i class="fas fa-leaf fa-2x text-warning ml-3"></i>
                <div>
                    <h4 class="text-white mb-0 font-weight-bold">تنسيق الحدائق وهندسة المواقع</h4>
                    <span class="text-white-50 small">كود المقرر: UPD141</span>
                </div>
            </div>

            <!-- اللوجوهات -->
            <div class="header-logos">
                <img src="pud_logo.png" alt="PUD Logo" title="قسم التخطيط">
                <img src="eng_logo.png" alt="Faculty Logo" title="كلية الهندسة">
                <img src="tanta_logo.png" alt="University Logo" title="جامعة طنطا">
            </div>

        </div>
    </nav>

    <div class="container d-md-none mt-3">
        <div class="header-logos-mobile bg-white rounded-pill p-2 shadow-sm">
            <img src="pud_logo.png" alt="PUD">
            <img src="eng_logo.png" alt="ENG">
            <img src="tanta_logo.png" alt="Tanta">
        </div>
    </div>

    <!-- المحتوى -->
    <div class="container">
        <div class="quiz-container">
            <div class="text-center mb-5">
                <h2 style="color: var(--color); font-weight: 800;">اختبار المحاضرة السابعة</h2>
                <p class="lead text-muted">تطبيق مبادئ التصميم: المحاور، المقياس، الوحدة، التوازن، والعناصر البصرية (أسئلة تطبيقية)</p>
                <div style="width: 80px; height: 5px; background: var(--color); margin: 10px auto; border-radius: 10px;"></div>
                <span class="badge badge-dark p-2 mt-2">45 سؤال</span>
            </div>

            <form id="quizForm">
                
                <div class="section-header"><h4><i class="fas fa-ruler-combined ml-2"></i> أولاً: المحاور، المقياس، والوحدة</h4></div>
                <div id="section1-container"></div>

                <div class="section-header" style="background: linear-gradient(45deg, #1e3c72, #2a5298);"><h4><i class="fas fa-balance-scale ml-2"></i> ثانياً: التوازن، السيادة، والبساطة</h4></div>
                <div id="section2-container"></div>

                <div class="section-header" style="background: linear-gradient(45deg, #11998e, #38ef7d);"><h4><i class="fas fa-random ml-2"></i> ثالثاً: الإيقاع، التتابع، والتنافر</h4></div>
                <div id="section3-container"></div>

                <div class="section-header" style="background: linear-gradient(45deg, #56ab2f, #a8e063);"><h4><i class="fas fa-tree ml-2"></i> رابعاً: التقسيم، المبنى، والإضاءة</h4></div>
                <div id="section4-container"></div>

                <div class="section-header" style="background: linear-gradient(45deg, #cb2d3e, #ef473a);"><h4><i class="fas fa-check-double ml-2"></i> خامساً: أسئلة الصواب والخطأ (تطبيقية)</h4></div>
                <div id="section5-container"></div>

                <div class="text-center mt-5">
                    <button type="button" class="btn btn-warning btn-lg pulse-button" onclick="calculateResult()">
                        <i class="fas fa-clipboard-check ml-2"></i> إنهاء الاختبار وعرض النتيجة
                    </button>
                </div>

            </form>

            <!-- صندوق النتيجة -->
            <div id="resultBox" class="result-box">
                <i class="fas fa-award fa-3x text-warning mb-3"></i>
                <h3>نتيجتك النهائية</h3>
                <div class="result-score" id="scoreDisplay">0 / 45</div>
                <p id="scoreMessage" class="lead"></p>
                
                <!-- زر عرض الأخطاء الجديد -->
                <button id="btnShowMistakes" class="btn btn-outline-light mt-2 mb-3" style="display: none;" onclick="toggleMistakes()">
                    <i class="fas fa-exclamation-triangle ml-2"></i> عرض سجل الأخطاء وتصحيحها
                </button>

                <!-- منطقة تقرير الأخطاء -->
                <div id="mistakesReport">
                    <h4 class="text-dark border-bottom pb-2 mb-3">سجل الإجابات الخاطئة</h4>
                    <div id="mistakesList"></div>
                </div>

                <hr style="border-top: 1px solid #555;">
                <button class="btn btn-light mt-3" onclick="location.reload()">
                    <i class="fas fa-redo ml-2"></i> إعادة المحاولة
                </button>
            </div>

        </div>
    </div>

    <footer class="text-center text-white py-4 mt-5" style="background-color: var(--dark);">
        <p class="mb-0 font-weight-bold">جامعة طنطا - كلية الهندسة - قسم التخطيط والتصميم العمراني</p>
        <small class="text-white-50">إعداد: أ.م.د لبنى عبد الله أغا | تنسيق الحدائق وهندسة المواقع</small>
    </footer>

    <!-- السكربت -->
    <script>
        // قاعدة بيانات الأسئلة - المحاضرة السابعة
        const questions = [
            // === القسم الأول: المحاور، المقياس، الوحدة ===
            {
                q: "في حديقة صغيرة داخل حي سكني، استخدام محور طولي طويل يؤدي غالبًا إلى:",
                options: ["زيادة الإحساس بالاتساع", "تضخيم الفراغ بصريًا", "تقليل الإحساس بالمساحة", "تحسين التهوية"],
                a: 0, type: "section1"
            },
            {
                q: "يُفضل كسر المحور عندما:",
                options: ["تكون الحديقة هندسية", "يراد خلق مفاجآت بصرية", "يكون الموقع مستوٍ", "يكون الفراغ متماثل"],
                a: 1, type: "section1"
            },
            {
                q: "إنهاء المحور بعنصر مائي مناسب عندما يكون الهدف:",
                options: ["تقليل الحركة", "خلق نقطة جذب بصرية", "تقليل التكلفة", "إخفاء الفراغ"],
                a: 1, type: "section1"
            },
            {
                q: "في حدائق الأطفال، المحور الصارم يؤدي إلى:",
                options: ["الأمان", "الملل والجمود", "التنظيم الأمثل", "سهولة الصيانة"],
                a: 1, type: "section1"
            },
            {
                q: "السبب الأساسي لفشل كثير من الحدائق الحديثة هو:",
                options: ["قلة النباتات", "تجاهل المقياس الإنساني", "ضعف الإضاءة", "قلة الألوان"],
                a: 1, type: "section1"
            },
            {
                q: "لخلق إحساس بالراحة النفسية، يجب أن يكون المقياس:",
                options: ["تذكاري", "ضخم", "إنساني", "عشوائي"],
                a: 2, type: "section1"
            },
            {
                q: "زيادة ارتفاع الأشجار مقارنة بعرض الممر يؤدي إلى:",
                options: ["إحساس بالاتساع", "إحساس بالضغط", "إحساس بالحرية", "لا تأثير"],
                a: 1, type: "section1"
            },
            {
                q: "المقياس التذكاري مناسب أكثر لـ:",
                options: ["حدائق الأحياء", "حدائق المدارس", "الساحات التذكارية", "الحدائق المنزلية"],
                a: 2, type: "section1"
            },
            {
                q: "تتحقق الوحدة عندما يشعر المستخدم أن:",
                options: ["العناصر متشابهة", "الحديقة مملة", "كل عنصر ينتمي للكل", "العناصر قليلة"],
                a: 2, type: "section1"
            },
            {
                q: "الإكثار من أنواع النباتات غالبًا يؤدي إلى:",
                options: ["التنوع الصحي", "فقدان الوحدة", "زيادة الجمال", "تقليل الصيانة"],
                a: 1, type: "section1"
            },
            {
                q: "أفضل وسيلة لتحقيق الوحدة في موقع كبير هي:",
                options: ["التكرار العشوائي", "ربط الفراغات بمحاور واضحة", "زيادة عدد العناصر", "تغيير الألوان باستمرار"],
                a: 1, type: "section1"
            },

            // === القسم الثاني: التوازن، السيادة، البساطة ===
            {
                q: "التوازن البصري لا يشترط:",
                options: ["تساوي المساحات", "تساوي الجذب البصري", "تماثل العناصر", "راحة العين"],
                a: 2, type: "section2"
            },
            {
                q: "التوازن غير المتماثل مناسب أكثر لـ:",
                options: ["الحدائق الرسمية", "الحدائق الطبيعية", "الحدائق التذكارية", "الساحات العسكرية"],
                a: 1, type: "section2"
            },
            {
                q: "استخدام شجرة كبيرة في جانب واحد يتطلب:",
                options: ["إزالة الشجرة", "عنصر بصري معادل", "تجاهلها", "تكرارها"],
                a: 1, type: "section2"
            },
            {
                q: "عنصر السيادة يجب أن يكون:",
                options: ["الأكبر دائمًا", "الأغلى", "الأكثر جذبًا للانتباه", "في المنتصف فقط"],
                a: 2, type: "section2"
            },
            {
                q: "كثرة العناصر السائدة تؤدي إلى:",
                options: ["قوة التصميم", "وضوح المشهد", "التشويش البصري", "زيادة الوحدة"],
                a: 2, type: "section2"
            },
            {
                q: "في حديقة عامة، أفضل عنصر سيادة هو:",
                options: ["النجيل", "عنصر مائي أو معلم بصري", "ممر خدمة", "سور الحديقة"],
                a: 1, type: "section2"
            },
            {
                q: "البساطة لا تعني:",
                options: ["قلة العناصر", "الفقر التصميمي", "وضوح الفكرة", "سهولة الصيانة"],
                a: 1, type: "section2"
            },
            {
                q: "أول علامة على فشل البساطة هي:",
                options: ["كثرة الألوان", "ازدحام العناصر", "استخدام نباتات محلية", "وضوح المسارات"],
                a: 1, type: "section2"
            },

            // === القسم الثالث: الإيقاع، التتابع، التنافر ===
            {
                q: "الإيقاع يتحقق من خلال:",
                options: ["التكرار فقط", "التنوع فقط", "التكرار مع التنوع", "العشوائية"],
                a: 2, type: "section3"
            },
            {
                q: "الإيقاع المتدرج يُستخدم عندما يكون الهدف:",
                options: ["الإثارة", "التوجيه البصري", "المفاجأة", "الصدمة"],
                a: 1, type: "section3"
            },
            {
                q: "التتابع الجيد يجعل المستخدم يشعر بـ:",
                options: ["الضياع", "السلاسة", "الملل", "الانغلاق"],
                a: 1, type: "section3"
            },
            {
                q: "في الحديقة الصغيرة، التتابع الأفضل يكون:",
                options: ["مباشر", "متدرج", "مفاجئ", "عشوائي"],
                a: 1, type: "section3"
            },
            {
                q: "التنافر يستخدم عندما نريد:",
                options: ["الهدوء", "جذب الانتباه", "الوحدة", "الراحة"],
                a: 1, type: "section3"
            },
            {
                q: "الإفراط في التنافر يؤدي إلى:",
                options: ["تصميم جريء", "فقدان الهوية", "قوة الشخصية", "وضوح المشهد"],
                a: 1, type: "section3"
            },

            // === القسم الرابع: التقسيم، المبنى، الإضاءة ===
            {
                q: "تقسيم الحديقة هدفه الأساسي:",
                options: ["زيادة المساحة", "تنظيم الاستخدامات", "زيادة النباتات", "تقليل الحركة"],
                a: 1, type: "section4"
            },
            {
                q: "أفضل وسيلة للتقسيم الناعم هي:",
                options: ["الأسوار الخرسانية", "الأسيجة النباتية", "الجدران العالية", "المباني"],
                a: 1, type: "section4"
            },
            {
                q: "فشل كثير من الحدائق سببه:",
                options: ["ضعف الزراعة", "تجاهل المبنى", "قلة الميزانية", "كثرة المستخدمين"],
                a: 1, type: "section4"
            },
            {
                q: "زراعة الأساس تهدف إلى:",
                options: ["إخفاء المبنى", "ربطه تدريجيًا بالأرض", "عزله", "تقليله بصريًا"],
                a: 1, type: "section4"
            },
            {
                q: "الإضاءة الجيدة ليلًا يجب أن:",
                options: ["تكون قوية", "تكون مخفية وموجهة", "تضيء كل شيء", "تلغي الظلال"],
                a: 1, type: "section4"
            },
            {
                q: "الألوان الباردة تستخدم عندما نريد:",
                options: ["تقليل المساحة", "توسيع الفراغ بصريًا", "الإثارة", "السيادة"],
                a: 1, type: "section4"
            },

            // === القسم الخامس: صواب وخطأ ===
            { q: "المحور الصارم مناسب لكل أنواع الحدائق.", options: ["صواب", "خطأ"], a: 1, type: "section5" },
            { q: "المقياس الإنساني أهم من الجمال الشكلي.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "كثرة العناصر السائدة تضعف التصميم.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "الوحدة لا تعني التشابه التام.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "التوازن البصري أهم من التماثل الحسابي.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "البساطة تقلل تكلفة الصيانة.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "الإيقاع ينظم حركة العين داخل الحديقة.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "التنافر يجب استخدامه بحذر.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "التقسيم الخاطئ يربك المستخدم.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "تجاهل علاقة المبنى بالحديقة خطأ تصميمي.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "الإضاءة عنصر جمالي ووظيفي في نفس الوقت.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "اللون الأخضر عنصر محايد بصريًا.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "التتابع الجيد يحسن تجربة المستخدم.", options: ["صواب", "خطأ"], a: 0, type: "section5" },
            { q: "التصميم الجيد هو الذي لا يُشعر المستخدم بالتعب.", options: ["صواب", "خطأ"], a: 0, type: "section5" }
        ];

        // دالة لعرض الأسئلة
        function renderQuestions() {
            questions.forEach((q, index) => {
                let containerId = "";
                if (q.type === "section1") containerId = "section1-container";
                else if (q.type === "section2") containerId = "section2-container";
                else if (q.type === "section3") containerId = "section3-container";
                else if (q.type === "section4") containerId = "section4-container";
                else containerId = "section5-container";

                const container = document.getElementById(containerId);
                
                const html = `
                    <div class="question-box" id="q-box-${index}">
                        <div class="question-title"><span class="badge badge-warning ml-2">${index + 1}</span> ${q.q}</div>
                        <div class="options">
                            ${q.options.map((opt, i) => `
                                <label>
                                    <input type="radio" name="q${index}" value="${i}"> <span>${opt}</span>
                                </label>
                            `).join('')}
                        </div>
                        <div class="feedback" id="feedback-${index}"></div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // دالة إظهار/إخفاء قسم الأخطاء
        function toggleMistakes() {
            const report = document.getElementById('mistakesReport');
            const btn = document.getElementById('btnShowMistakes');
            
            if (report.style.display === "none" || report.style.display === "") {
                report.style.display = "block";
                btn.innerHTML = `<i class="fas fa-eye-slash ml-2"></i> إخفاء سجل الأخطاء`;
                report.scrollIntoView({behavior: "smooth"});
            } else {
                report.style.display = "none";
                btn.innerHTML = `<i class="fas fa-exclamation-triangle ml-2"></i> عرض سجل الأخطاء وتصحيحها`;
            }
        }

        // حساب النتيجة وتوليد تقرير الأخطاء
        function calculateResult() {
            let score = 0;
            let allAnswered = true;
            let mistakesHTML = '';

            questions.forEach((q, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                const feedbackDiv = document.getElementById(`feedback-${index}`);
                const qBox = document.getElementById(`q-box-${index}`);
                
                // إعادة تهيئة الستايل
                qBox.classList.remove('correct-box', 'wrong-box');
                feedbackDiv.style.display = 'none';

                let userAnswerText = "لم يتم الإجابة";
                let isCorrect = false;

                if (selected) {
                    const val = parseInt(selected.value);
                    userAnswerText = q.options[val];
                    if (val === q.a) {
                        score++;
                        isCorrect = true;
                        qBox.classList.add('correct-box');
                        feedbackDiv.innerHTML = `<i class="fas fa-check-circle"></i> <strong>إجابة صحيحة!</strong>`;
                        feedbackDiv.style.color = '#155724';
                        feedbackDiv.style.backgroundColor = '#d4edda';
                    } else {
                        qBox.classList.add('wrong-box');
                        feedbackDiv.innerHTML = `
                            <i class="fas fa-times-circle"></i> <strong>إجابة خاطئة.</strong>
                            <br>الإجابة الصحيحة هي: <span class="text-success font-weight-bold">${q.options[q.a]}</span>
                        `;
                        feedbackDiv.style.color = '#721c24';
                        feedbackDiv.style.backgroundColor = '#f8d7da';
                    }
                    feedbackDiv.style.display = 'block';
                } else {
                    allAnswered = false;
                    qBox.classList.add('wrong-box');
                }

                // إضافة للسجل إذا كانت خطأ أو لم يتم الإجابة
                if (!isCorrect) {
                    mistakesHTML += `
                        <div class="mistake-card">
                            <div class="mistake-question"><span class="badge badge-danger ml-2">سؤال ${index + 1}</span> ${q.q}</div>
                            <div class="answer-comparison">
                                <div class="user-answer"><i class="fas fa-times ml-2"></i> إجابتك: ${userAnswerText}</div>
                                <div class="correct-answer-text"><i class="fas fa-check ml-2"></i> الصحيح: ${q.options[q.a]}</div>
                            </div>
                        </div>
                    `;
                }
            });

            if(!allAnswered) {
                alert("انتبه: لم تقم بالإجابة على جميع الأسئلة!");
            }

            // عرض النتيجة
            const resultBox = document.getElementById('resultBox');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreMessage = document.getElementById('scoreMessage');
            const btnShowMistakes = document.getElementById('btnShowMistakes');
            const mistakesList = document.getElementById('mistakesList');

            resultBox.style.display = 'block';
            scoreDisplay.innerText = `${score} / ${questions.length}`;

            // التعامل مع زر الأخطاء
            if (score === questions.length) {
                mistakesList.innerHTML = "";
                btnShowMistakes.style.display = "none";
                document.getElementById('mistakesReport').style.display = "none";
                scoreMessage.innerText = "ماشاء الله! إجابات كاملة صحيحة. لا توجد أخطاء لعرضها.";
                scoreMessage.style.color = "#28a745";
            } else {
                mistakesList.innerHTML = mistakesHTML;
                btnShowMistakes.style.display = "inline-block";
                document.getElementById('mistakesReport').style.display = "none"; // نخفيه في البداية
                
                const percentage = (score / questions.length) * 100;
                if (percentage >= 75) {
                    scoreMessage.innerText = "جيد جداً! لديك بعض الأخطاء البسيطة.";
                    scoreMessage.style.color = "#ffc107";
                } else {
                    scoreMessage.innerText = "تحتاج لمراجعة المحاضرة، لديك عدة أخطاء.";
                    scoreMessage.style.color = "#dc3545";
                }
            }

            resultBox.scrollIntoView({ behavior: 'smooth' });
        }

        // تشغيل
        renderQuestions();

    </script>
</body>
</html>